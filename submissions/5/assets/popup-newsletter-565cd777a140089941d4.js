(window.webpackJsonp_gp_web_frontend=window.webpackJsonp_gp_web_frontend||[]).push([["popup-newsletter"],{"./src/ts/components/popup-newsletter/popup-newsletter.ts":(e,t,n)=>{"use strict";n.r(t),n.d(t,{getSignedUp:()=>l,getPageViewCount:()=>d,setPageViewCount:()=>u,getPopupDisplayStatus:()=>w,show:()=>g,hide:()=>y,subscribeToCRM:()=>h,increasePageView:()=>b,subscribe:()=>S,observeWindowScroll:()=>_,popupNewsletterComponent:()=>f,init:()=>L});var s=n("../react-components/dist/components/global/newsletter/popup-newsletter/popup-newsletter.css.json"),o=n("../shared-types/frontend/components/newsletter/subscription-status.ts"),r=n("../shared-types/frontend/core/store.ts"),i=n("../../node_modules/js-cookie/src/js.cookie.js"),a=n.n(i),c=n("./src/ts/utils/crm.ts"),p=n("./src/ts/utils/inview.ts");const l=()=>"true"===a().get(o.y.SignedUp),d=()=>parseInt(a().get(o.y.PageViewCount),10)||0,u=e=>{const t=new Date((new Date).getTime()+36e5);a().set(o.y.PageViewCount,e.toString(),{expires:t})},w=()=>{const e=localStorage.getItem("_TO_Pop_Display");return e&&Date.now()>parseInt(e,10)?(localStorage.removeItem("_TO_Pop_Display"),!1):!!e},m=(e,t)=>{e.setAttribute("hidden","false");const n=new Date;n.setMilliseconds(n.getMilliseconds()+1728e5),localStorage.setItem("_TO_Pop_Display",""+n.getTime()),t.dispatch({type:r.U.TrackEvent,payload:{pev2:"newsletter popup displayed",events:["event113"]}})},g=(e,t)=>()=>{const n=document.querySelector("#inline-placement")||document.querySelector(".anyclip-placement");(null==n?void 0:n.childNodes.length)?(0,p.oO)({element:n,isNotInViewportCallback:()=>{m(e,t)}}):m(e,t)},y=(e,t)=>()=>{e.setAttribute("hidden","true"),t.dispatch({type:r.U.TrackEvent,payload:{pev2:"newsletter popup dismissed",events:["event207"]}})},h=(e,t)=>{const n=t.subscribe(()=>{const o=t.getState();if(o.crm.receive)n(),v(e,o.crm.receive.type);else if(o.crm.error){e.querySelector("."+s.N3).innerHTML=o.crm.error.message,e.classList.add(s.yt)}})},v=(e,t)=>{e.classList.add(s.UJ),"popup"===t&&(0,c.W)(t)},b=()=>{u(d()+1)},S=(e,t)=>n=>{n.preventDefault();const o=e.querySelector(`.${s.Y2}.${s.Do}`);(0,c.C)(t,{copyVersion:"0001",element:"newsletter-popup",email:o.value,referrer:window.location.href})},_=()=>new Promise(e=>{const t=()=>{(window.innerHeight+window.scrollY)/document.body.offsetHeight>=.6&&(e({}),window.removeEventListener("scroll",t))};window.addEventListener("scroll",t)}),f=(e,t)=>{const n={hide:y(e,t),show:g(e,t),bindEvents:()=>{b();const o=new URLSearchParams(window.location.search).get("cid");if(l()||w()||(()=>{const{city:e,language:t}=window.digitalData.page.pageInfo;return[{exemptCity:"barcelona",exemptLanguages:["en"]},{exemptCity:"madrid",exemptLanguages:["en"]}].some(({exemptCity:n,exemptLanguages:s})=>n===e.toLowerCase()&&s.includes(t.toLowerCase()))})()||o)return e.remove(),{};const r=y(e,t);return e.querySelector("."+s.Ah).addEventListener("click",n.hide),e.querySelector("."+s.cZ).addEventListener("click",r),e.querySelector("."+s.cr).addEventListener("submit",S(e,t)),1===d()?setTimeout(()=>{n.show()},4e4):_().then(n.show),h(e,t),{hide:n.hide}}};return n},L=(e,t)=>{const n=Math.floor(1e4*Math.random());return{listeners:f(e,t).bindEvents(),componentId:"navigation-"+n}}}}]);